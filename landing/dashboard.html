<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - StyleMCP</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #0a0a0b;
      --bg-elevated: #141416;
      --bg-card: #1a1a1e;
      --bg-card-hover: #222226;
      --border: #2a2a2e;
      --border-hover: #3a3a3e;
      --text: #fafafa;
      --text-muted: #a1a1aa;
      --text-dim: #71717a;
      --accent: #6366f1;
      --accent-hover: #818cf8;
      --accent-glow: rgba(99, 102, 241, 0.15);
      --purple: #a855f7;
      --green: #22c55e;
      --green-dim: rgba(34, 197, 94, 0.15);
      --yellow: #eab308;
      --yellow-dim: rgba(234, 179, 8, 0.15);
      --red: #ef4444;
      --red-dim: rgba(239, 68, 68, 0.15);
      --blue: #3b82f6;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      min-height: 100vh;
    }

    /* Layout */
    .layout {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background: var(--bg-elevated);
      border-right: 1px solid var(--border);
      padding: 24px;
      position: fixed;
      height: 100vh;
      display: flex;
      flex-direction: column;
      z-index: 50;
    }

    .sidebar-header {
      margin-bottom: 32px;
    }

    .sidebar-logo {
      font-weight: 700;
      font-size: 1.25rem;
      color: var(--text);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--accent) 0%, var(--purple) 100%);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 16px;
      color: white;
    }

    .nav-section {
      margin-bottom: 24px;
    }

    .nav-label {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-dim);
      padding: 0 12px;
      margin-bottom: 8px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 11px 12px;
      color: var(--text-muted);
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 500;
      border-radius: 10px;
      margin-bottom: 4px;
      transition: all 0.2s ease;
      position: relative;
    }

    .nav-link:hover {
      background: var(--bg-card);
      color: var(--text);
    }

    .nav-link.active {
      background: linear-gradient(135deg, var(--accent-glow) 0%, rgba(168, 85, 247, 0.1) 100%);
      color: var(--text);
    }

    .nav-link.active::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 3px;
      height: 20px;
      background: linear-gradient(180deg, var(--accent), var(--purple));
      border-radius: 0 2px 2px 0;
    }

    .nav-link svg {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
    }

    .nav-badge {
      margin-left: auto;
      padding: 2px 8px;
      background: var(--accent);
      color: white;
      font-size: 0.7rem;
      font-weight: 600;
      border-radius: 50px;
    }

    .sidebar-footer {
      margin-top: auto;
      padding-top: 24px;
      border-top: 1px solid var(--border);
    }

    .user-card {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      margin-bottom: 12px;
      transition: all 0.2s;
    }

    .user-card:hover {
      border-color: var(--border-hover);
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--accent), var(--purple));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 1rem;
      color: white;
    }

    .user-info {
      flex: 1;
      min-width: 0;
    }

    .user-name {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .user-email {
      font-size: 0.75rem;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .btn-logout {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      padding: 10px 16px;
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
      border-radius: 10px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-logout:hover {
      background: var(--bg-card);
      border-color: var(--border-hover);
      color: var(--text);
    }

    .btn-logout svg {
      width: 16px;
      height: 16px;
    }

    /* Main Content */
    .main {
      flex: 1;
      margin-left: 260px;
      padding: 32px 48px;
      min-height: 100vh;
    }

    /* Page Header */
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 32px;
    }

    .page-header-content h1 {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 6px;
      letter-spacing: -0.02em;
    }

    .page-header-content p {
      color: var(--text-muted);
      font-size: 0.95rem;
    }

    .header-actions {
      display: flex;
      gap: 12px;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: 10px;
      font-weight: 500;
      font-size: 0.9rem;
      text-decoration: none;
      transition: all 0.2s;
      cursor: pointer;
      border: none;
    }

    .btn svg {
      width: 16px;
      height: 16px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent) 0%, var(--purple) 100%);
      color: white;
      box-shadow: 0 4px 12px var(--accent-glow);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px var(--accent-glow);
    }

    .btn-secondary {
      background: var(--bg-card);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--bg-card-hover);
      border-color: var(--border-hover);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-muted);
      padding: 8px;
      border-radius: 8px;
    }

    .btn-ghost:hover {
      background: var(--bg-card);
      color: var(--text);
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent), var(--purple));
      opacity: 0;
      transition: opacity 0.2s;
    }

    .stat-card:hover {
      border-color: var(--border-hover);
      transform: translateY(-2px);
    }

    .stat-card:hover::before {
      opacity: 1;
    }

    .stat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .stat-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .stat-icon.accent {
      background: var(--accent-glow);
      color: var(--accent);
    }

    .stat-icon.green {
      background: var(--green-dim);
      color: var(--green);
    }

    .stat-icon.yellow {
      background: var(--yellow-dim);
      color: var(--yellow);
    }

    .stat-icon.purple {
      background: rgba(168, 85, 247, 0.15);
      color: var(--purple);
    }

    .stat-icon svg {
      width: 20px;
      height: 20px;
    }

    .stat-trend {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .stat-trend.up {
      color: var(--green);
    }

    .stat-trend.down {
      color: var(--red);
    }

    .stat-label {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      line-height: 1.2;
    }

    .stat-sub {
      font-size: 0.8rem;
      color: var(--text-dim);
      margin-top: 4px;
    }

    /* Tier Badges */
    .tier-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 14px;
      border-radius: 50px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }

    .tier-badge.free {
      background: rgba(161, 161, 170, 0.15);
      color: var(--text-muted);
    }

    .tier-badge.pro {
      background: linear-gradient(135deg, var(--accent-glow) 0%, rgba(168, 85, 247, 0.15) 100%);
      color: var(--accent);
    }

    .tier-badge.team {
      background: rgba(168, 85, 247, 0.15);
      color: var(--purple);
    }

    .tier-badge.enterprise {
      background: var(--green-dim);
      color: var(--green);
    }

    /* Progress Bar */
    .progress-container {
      margin-top: 16px;
    }

    .progress-bar {
      height: 6px;
      background: var(--bg-elevated);
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--purple));
      border-radius: 3px;
      transition: width 0.5s ease;
    }

    .progress-fill.warning {
      background: linear-gradient(90deg, var(--yellow), #f59e0b);
    }

    .progress-fill.danger {
      background: linear-gradient(90deg, var(--red), #f97316);
    }

    /* Cards */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      margin-bottom: 24px;
      overflow: hidden;
      transition: all 0.2s;
    }

    .card:hover {
      border-color: var(--border-hover);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      background: var(--bg-elevated);
    }

    .card-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1rem;
      font-weight: 600;
    }

    .card-title svg {
      width: 18px;
      height: 18px;
      color: var(--accent);
    }

    .card-body {
      padding: 24px;
    }

    /* API Key Section */
    .api-key-container {
      display: flex;
      align-items: center;
      gap: 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px 20px;
      transition: all 0.2s;
    }

    .api-key-container:hover {
      border-color: var(--border-hover);
    }

    .api-key-icon {
      width: 36px;
      height: 36px;
      background: var(--accent-glow);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--accent);
      flex-shrink: 0;
    }

    .api-key-icon svg {
      width: 18px;
      height: 18px;
    }

    .api-key-content {
      flex: 1;
      min-width: 0;
    }

    .api-key-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .api-key-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.9rem;
      color: var(--text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .api-key-value.masked {
      color: var(--text-muted);
    }

    .api-key-actions {
      display: flex;
      gap: 8px;
    }

    .btn-icon {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-icon:hover {
      background: var(--bg-card-hover);
      border-color: var(--border-hover);
      color: var(--text);
    }

    .btn-icon svg {
      width: 16px;
      height: 16px;
    }

    /* Quick Start Code */
    .code-block {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      margin-top: 20px;
    }

    .code-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: var(--bg-elevated);
      border-bottom: 1px solid var(--border);
    }

    .code-header-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .code-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .code-dot.red { background: #ff5f57; }
    .code-dot.yellow { background: #febc2e; }
    .code-dot.green { background: #28c840; }

    .code-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      font-weight: 500;
    }

    .code-body {
      padding: 20px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
      overflow-x: auto;
      line-height: 1.7;
    }

    .code-body .comment { color: var(--text-dim); }
    .code-body .string { color: var(--green); }
    .code-body .key { color: var(--purple); }

    /* Onboarding */
    .onboarding-card {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.08) 0%, rgba(168, 85, 247, 0.08) 100%);
      border: 1px solid rgba(99, 102, 241, 0.2);
      border-radius: 16px;
      margin-bottom: 24px;
      overflow: hidden;
      position: relative;
    }

    .onboarding-card.hidden {
      display: none;
    }

    .onboarding-progress {
      height: 3px;
      background: rgba(99, 102, 241, 0.1);
    }

    .onboarding-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--purple));
      transition: width 0.5s ease;
    }

    .onboarding-dismiss {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 28px;
      height: 28px;
      background: rgba(255, 255, 255, 0.05);
      border: none;
      border-radius: 6px;
      color: var(--text-muted);
      font-size: 18px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .onboarding-dismiss:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text);
    }

    .onboarding-header {
      padding: 20px 24px 12px;
    }

    .onboarding-header h3 {
      font-size: 1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .onboarding-header h3 span {
      font-weight: 500;
      color: var(--text-muted);
      font-size: 0.85rem;
    }

    .onboarding-steps {
      padding: 0 16px 16px;
    }

    .onboarding-step {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .onboarding-step:hover {
      background: rgba(255, 255, 255, 0.03);
    }

    .onboarding-step.completed {
      opacity: 0.5;
    }

    .step-indicator {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--bg-card);
      border: 2px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-muted);
      flex-shrink: 0;
      transition: all 0.2s;
    }

    .onboarding-step.completed .step-indicator {
      background: var(--green);
      border-color: var(--green);
      color: white;
    }

    .onboarding-step.completed .step-indicator span {
      display: none;
    }

    .onboarding-step.completed .step-indicator::after {
      content: '‚úì';
      font-size: 14px;
    }

    .step-content {
      flex: 1;
    }

    .step-title {
      font-weight: 500;
      font-size: 0.9rem;
      margin-bottom: 2px;
    }

    .step-desc {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .step-arrow {
      color: var(--text-dim);
      opacity: 0;
      transition: all 0.2s;
    }

    .onboarding-step:hover .step-arrow {
      opacity: 1;
      transform: translateX(4px);
    }

    .onboarding-step.completed .step-arrow {
      display: none;
    }

    .onboarding-cta {
      display: block;
      width: calc(100% - 32px);
      margin: 8px 16px 16px;
      padding: 12px 24px;
      background: linear-gradient(135deg, var(--accent) 0%, var(--purple) 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: 500;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .onboarding-cta:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px var(--accent-glow);
    }

    .onboarding-complete {
      text-align: center;
      padding: 32px;
    }

    .onboarding-complete h3 {
      color: var(--green);
      margin-bottom: 8px;
    }

    .onboarding-complete p {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    /* Welcome Modal */
    .modal {
      position: fixed;
      inset: 0;
      z-index: 200;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .modal.hidden {
      display: none;
    }

    .modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
    }

    .modal-content {
      position: relative;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 24px;
      padding: 48px;
      max-width: 520px;
      width: 100%;
      text-align: center;
      animation: modalIn 0.3s ease;
    }

    @keyframes modalIn {
      from {
        opacity: 0;
        transform: scale(0.95) translateY(10px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 32px;
      height: 32px;
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-muted);
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .modal-close:hover {
      background: var(--bg-card-hover);
      color: var(--text);
    }

    .modal-icon {
      width: 64px;
      height: 64px;
      background: linear-gradient(135deg, var(--accent-glow) 0%, rgba(168, 85, 247, 0.15) 100%);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      margin: 0 auto 20px;
    }

    .modal-content h2 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .modal-content > p {
      color: var(--text-muted);
      margin-bottom: 32px;
      font-size: 0.95rem;
    }

    .goal-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .goal-btn {
      background: var(--bg);
      border: 2px solid var(--border);
      border-radius: 14px;
      padding: 18px;
      text-align: left;
      cursor: pointer;
      transition: all 0.2s;
    }

    .goal-btn:hover {
      border-color: var(--accent);
      background: var(--accent-glow);
    }

    .goal-btn.selected {
      border-color: var(--accent);
      background: var(--accent-glow);
    }

    .goal-emoji {
      font-size: 28px;
      display: block;
      margin-bottom: 10px;
    }

    .goal-title {
      display: block;
      font-weight: 600;
      color: var(--text);
      font-size: 0.9rem;
      margin-bottom: 4px;
    }

    .goal-desc {
      display: block;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* Loading */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 60vh;
      gap: 16px;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      padding: 14px 20px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.9rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      animation: toastIn 0.3s ease;
      z-index: 300;
    }

    .toast.success {
      border-color: var(--green);
    }

    .toast.success .toast-icon {
      color: var(--green);
    }

    @keyframes toastIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        display: none;
      }
      
      .main {
        margin-left: 0;
        padding: 24px;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .page-header {
        flex-direction: column;
        gap: 16px;
      }

      .header-actions {
        width: 100%;
      }

      .header-actions .btn {
        flex: 1;
      }

      .goal-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="layout">
    <nav class="sidebar">
      <div class="sidebar-header">
        <a href="/" class="sidebar-logo">
          <div class="logo-icon">S</div>
          StyleMCP
        </a>
      </div>

      <div class="nav-section">
        <div class="nav-label">Overview</div>
        <a href="/dashboard.html" class="nav-link active">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/></svg>
          Dashboard
        </a>
        <a href="/docs.html" class="nav-link">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>
          Documentation
        </a>
      </div>

      <div class="nav-section">
        <div class="nav-label">Account</div>
        <a href="/pricing.html" class="nav-link">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
          Billing
        </a>
        <a href="/status.html" class="nav-link">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
          API Status
        </a>
      </div>

      <div class="sidebar-footer">
        <div class="user-card">
          <div class="user-avatar" id="userAvatar">?</div>
          <div class="user-info">
            <div class="user-name" id="userName">Loading...</div>
            <div class="user-email" id="userEmail">...</div>
          </div>
        </div>
        <button class="btn-logout" id="logoutBtn">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
          Sign Out
        </button>
      </div>
    </nav>

    <main class="main">
      <div id="loading" class="loading">
        <div class="spinner"></div>
        <div class="loading-text">Loading dashboard...</div>
      </div>

      <!-- Welcome Modal -->
      <div id="welcomeModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
          <button class="modal-close" onclick="dismissWelcome()">&times;</button>
          <div class="modal-icon">‚ú®</div>
          <h2>Welcome to StyleMCP!</h2>
          <p>Let's personalize your experience. What brings you here today?</p>
          <div class="goal-grid">
            <button class="goal-btn" onclick="selectGoal('ai-agents')">
              <span class="goal-emoji">ü§ñ</span>
              <span class="goal-title">AI Agents</span>
              <span class="goal-desc">Keep agent outputs on-brand</span>
            </button>
            <button class="goal-btn" onclick="selectGoal('content-team')">
              <span class="goal-emoji">‚úçÔ∏è</span>
              <span class="goal-title">Content Team</span>
              <span class="goal-desc">Enforce style guide rules</span>
            </button>
            <button class="goal-btn" onclick="selectGoal('developer')">
              <span class="goal-emoji">üíª</span>
              <span class="goal-title">Developer</span>
              <span class="goal-desc">Integrate brand validation</span>
            </button>
            <button class="goal-btn" onclick="selectGoal('explore')">
              <span class="goal-emoji">üîç</span>
              <span class="goal-title">Just Exploring</span>
              <span class="goal-desc">See what StyleMCP can do</span>
            </button>
          </div>
        </div>
      </div>

      <div id="dashboard" style="display:none">
        <!-- Onboarding Checklist -->
        <div id="onboardingChecklist" class="onboarding-card">
          <div class="onboarding-progress">
            <div class="onboarding-progress-fill" id="progressFill" style="width:0%"></div>
          </div>
          <button class="onboarding-dismiss" onclick="dismissChecklist()">&times;</button>
          <div class="onboarding-header">
            <h3>üöÄ Getting Started <span id="checklistProgress">0/4 complete</span></h3>
          </div>
          <div class="onboarding-steps">
            <div class="onboarding-step" id="step1" onclick="goToStep(1)">
              <div class="step-indicator"><span>1</span></div>
              <div class="step-content">
                <div class="step-title">Copy your API key</div>
                <div class="step-desc">You'll need this to make requests</div>
              </div>
              <div class="step-arrow">‚Üí</div>
            </div>
            <div class="onboarding-step" id="step2" onclick="goToStep(2)">
              <div class="step-indicator"><span>2</span></div>
              <div class="step-content">
                <div class="step-title">Make your first API call</div>
                <div class="step-desc">Try the validation endpoint</div>
              </div>
              <div class="step-arrow">‚Üí</div>
            </div>
            <div class="onboarding-step" id="step3" onclick="goToStep(3)">
              <div class="step-indicator"><span>3</span></div>
              <div class="step-content">
                <div class="step-title">Explore style packs</div>
                <div class="step-desc">See available brand rules</div>
              </div>
              <div class="step-arrow">‚Üí</div>
            </div>
            <div class="onboarding-step" id="step4" onclick="goToStep(4)">
              <div class="step-indicator"><span>4</span></div>
              <div class="step-content">
                <div class="step-title">Read the documentation</div>
                <div class="step-desc">Learn all the features</div>
              </div>
              <div class="step-arrow">‚Üí</div>
            </div>
          </div>
          <button class="onboarding-cta" id="nextStepBtn" onclick="goToNextStep()">Copy API Key ‚Üí</button>
        </div>

        <div class="page-header">
          <div class="page-header-content">
            <h1>Dashboard</h1>
            <p>Monitor your API usage and manage your StyleMCP account</p>
          </div>
          <div class="header-actions">
            <a href="/docs.html" class="btn btn-secondary">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>
              View Docs
            </a>
            <a href="/pricing.html" class="btn btn-primary">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
              Upgrade
            </a>
          </div>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-icon accent">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/></svg>
              </div>
            </div>
            <div class="stat-label">Current Plan</div>
            <div class="stat-value"><span class="tier-badge" id="tierBadge">Free</span></div>
            <div class="stat-sub" id="planActions"><a href="/pricing.html" style="color:var(--accent)">Upgrade plan ‚Üí</a></div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-icon purple">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"/></svg>
              </div>
              <div class="stat-trend up">
                <svg width="12" height="12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/></svg>
                12%
              </div>
            </div>
            <div class="stat-label">Requests This Month</div>
            <div class="stat-value" id="usedCount">0</div>
            <div class="stat-sub">of <span id="limitCount">1,000</span> included</div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-icon green">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              </div>
            </div>
            <div class="stat-label">Remaining</div>
            <div class="stat-value" id="remainingCount" style="color:var(--green)">1,000</div>
            <div class="stat-sub">Resets <span id="resetDate">Feb 1</span></div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-icon yellow">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"/></svg>
              </div>
            </div>
            <div class="stat-label">Usage</div>
            <div class="stat-value" id="usagePercent">0%</div>
            <div class="progress-container">
              <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width:0%"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/></svg>
              API Key
            </div>
            <button class="btn btn-secondary" id="regenerateBtn" style="display:none">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
              Regenerate
            </button>
          </div>
          <div class="card-body">
            <div class="api-key-container">
              <div class="api-key-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/></svg>
              </div>
              <div class="api-key-content">
                <div class="api-key-label">Your secret API key</div>
                <div class="api-key-value masked" id="apiKey">sk_‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
              </div>
              <div class="api-key-actions">
                <button class="btn-icon" id="toggleKeyBtn" title="Show/Hide">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                </button>
                <button class="btn-icon" id="copyKeyBtn" title="Copy to clipboard">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
                </button>
              </div>
            </div>
            <p style="margin-top:16px;color:var(--text-muted);font-size:0.9rem">
              Include this key in your API requests using the <code style="background:var(--bg);padding:3px 8px;border-radius:6px;font-family:'JetBrains Mono',monospace;font-size:0.85rem">X-Api-Key</code> header.
            </p>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
              Quick Start
            </div>
          </div>
          <div class="card-body">
            <p style="color:var(--text-muted);margin-bottom:16px">Make your first API call to validate content against brand rules:</p>
            <div class="code-block">
              <div class="code-header">
                <div class="code-header-left">
                  <span class="code-dot red"></span>
                  <span class="code-dot yellow"></span>
                  <span class="code-dot green"></span>
                </div>
                <span class="code-label">Terminal</span>
              </div>
              <div class="code-body">
<pre><span class="comment"># Validate content against brand rules</span>
curl -X POST https://stylemcp.com/api/validate \
  -H <span class="string">"Content-Type: application/json"</span> \
  -H <span class="string">"X-Api-Key: <span id="curlApiKey">YOUR_API_KEY</span>"</span> \
  -d <span class="string">'{"text": "Click here to learn more!"}'</span></pre>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Configuration
    const SUPABASE_URL = 'https://orbliwjewqlnnutykozw.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9yYmxpd2pld3Fsbm51dHlrb3p3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkyNzE5MTEsImV4cCI6MjA4NDg0NzkxMX0.z2xrGw-3UqOHTQ28g7b83vBsavt9rDDP61MKo9I_ZSQ';

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let currentUser = null;
    let userProfile = null;
    let apiKeyVisible = false;

    // Toast notification
    function showToast(message, type = 'success') {
      const existing = document.querySelector('.toast');
      if (existing) existing.remove();

      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `
        <span class="toast-icon">${type === 'success' ? '‚úì' : '!'}</span>
        <span>${message}</span>
      `;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    async function init() {
      const { data: { session } } = await supabase.auth.getSession();

      if (!session) {
        window.location.href = '/login.html';
        return;
      }

      currentUser = session.user;

      await loadProfile();
      await loadUsage();

      document.getElementById('loading').style.display = 'none';
      document.getElementById('dashboard').style.display = 'block';
    }

    async function loadProfile() {
      const { data, error } = await supabase
        .from('profiles')
        .select('*')
        .eq('id', currentUser.id)
        .single();

      if (error) {
        console.error('Error loading profile:', error);
        return;
      }

      userProfile = data;

      // Update UI
      const email = currentUser.email;
      const name = email.split('@')[0];
      document.getElementById('userName').textContent = name.charAt(0).toUpperCase() + name.slice(1);
      document.getElementById('userEmail').textContent = email;
      document.getElementById('userAvatar').textContent = email.charAt(0).toUpperCase();

      const tierBadge = document.getElementById('tierBadge');
      tierBadge.textContent = data.tier.charAt(0).toUpperCase() + data.tier.slice(1);
      tierBadge.className = `tier-badge ${data.tier}`;

      document.getElementById('limitCount').textContent = data.monthly_request_limit.toLocaleString();
    }

    async function loadUsage() {
      const { data, error } = await supabase.rpc('get_usage_stats', {
        p_user_id: currentUser.id
      });

      if (error) {
        console.error('Error loading usage:', error);
        return;
      }

      const used = data.used || 0;
      const limit = data.limit || 1000;
      const remaining = data.remaining || limit;
      const percent = Math.round((used / limit) * 100);

      document.getElementById('usedCount').textContent = used.toLocaleString();
      document.getElementById('remainingCount').textContent = remaining.toLocaleString();
      document.getElementById('usagePercent').textContent = `${percent}%`;

      const progressBar = document.getElementById('progressBar');
      progressBar.style.width = `${percent}%`;
      if (percent >= 90) progressBar.classList.add('danger');
      else if (percent >= 75) progressBar.classList.add('warning');

      const resetDate = new Date(data.reset_date);
      document.getElementById('resetDate').textContent = resetDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

      const remainingEl = document.getElementById('remainingCount');
      if (remaining === 0) remainingEl.style.color = 'var(--red)';
      else if (remaining < limit * 0.1) remainingEl.style.color = 'var(--yellow)';
      else remainingEl.style.color = 'var(--green)';
    }

    // Toggle API key visibility
    document.getElementById('toggleKeyBtn').addEventListener('click', () => {
      apiKeyVisible = !apiKeyVisible;
      const keyEl = document.getElementById('apiKey');
      const curlKeyEl = document.getElementById('curlApiKey');

      if (apiKeyVisible) {
        keyEl.textContent = userProfile.api_key;
        keyEl.classList.remove('masked');
        curlKeyEl.textContent = userProfile.api_key;
      } else {
        keyEl.textContent = 'sk_‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
        keyEl.classList.add('masked');
        curlKeyEl.textContent = 'YOUR_API_KEY';
      }
    });

    // Copy API key
    document.getElementById('copyKeyBtn').addEventListener('click', async () => {
      await navigator.clipboard.writeText(userProfile.api_key);
      showToast('API key copied to clipboard');
      completeStep(1);
    });

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', async () => {
      await supabase.auth.signOut();
      window.location.href = '/';
    });

    // Upgrade to paid plan
    async function upgradeToPlan(tier) {
      try {
        const response = await fetch('/api/checkout', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ userId: currentUser.id, tier })
        });

        const data = await response.json();

        if (data.url) {
          window.location.href = data.url;
        } else {
          showToast('Failed to start checkout', 'error');
        }
      } catch (error) {
        console.error('Checkout error:', error);
        showToast('Failed to start checkout', 'error');
      }
    }

    // Open billing portal
    async function openBillingPortal() {
      try {
        const response = await fetch('/api/billing/portal', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ userId: currentUser.id })
        });

        const data = await response.json();

        if (data.url) {
          window.location.href = data.url;
        } else {
          showToast('Failed to open billing portal', 'error');
        }
      } catch (error) {
        console.error('Portal error:', error);
        showToast('Failed to open billing portal', 'error');
      }
    }

    function updatePlanActions() {
      const actionsEl = document.getElementById('planActions');
      if (!userProfile) return;

      if (userProfile.tier === 'free') {
        actionsEl.innerHTML = `<a href="#" onclick="upgradeToPlan('pro'); return false;" style="color:var(--accent)">Upgrade to Pro ‚Üí</a>`;
      } else if (userProfile.tier === 'pro') {
        actionsEl.innerHTML = `
          <a href="#" onclick="upgradeToPlan('team'); return false;" style="color:var(--accent)">Upgrade to Team</a> ¬∑ 
          <a href="#" onclick="openBillingPortal(); return false;" style="color:var(--text-muted)">Manage</a>
        `;
      } else if (userProfile.tier === 'team' || userProfile.tier === 'enterprise') {
        actionsEl.innerHTML = `<a href="#" onclick="openBillingPortal(); return false;" style="color:var(--accent)">Manage subscription ‚Üí</a>`;
      }
    }

    function checkCheckoutStatus() {
      const params = new URLSearchParams(window.location.search);
      if (params.get('checkout') === 'success') {
        showToast('üéâ Subscription activated! Your plan has been upgraded.');
        window.history.replaceState({}, '', '/dashboard.html');
      } else if (params.get('checkout') === 'cancelled') {
        window.history.replaceState({}, '', '/dashboard.html');
      }
    }

    checkCheckoutStatus();
    init().then(() => {
      updatePlanActions();
      initOnboarding();
    });

    // ===== ONBOARDING =====
    const STORAGE_PREFIX = 'stylemcp_';
    let selectedGoal = null;
    let completedSteps = [];

    function initOnboarding() {
      const userId = currentUser?.id || 'guest';
      
      const welcomeShown = localStorage.getItem(`${STORAGE_PREFIX}welcome_${userId}`);
      if (!welcomeShown) {
        document.getElementById('welcomeModal').classList.remove('hidden');
      }
      
      const saved = localStorage.getItem(`${STORAGE_PREFIX}steps_${userId}`);
      completedSteps = saved ? JSON.parse(saved) : [];
      
      const dismissed = localStorage.getItem(`${STORAGE_PREFIX}checklist_dismissed_${userId}`);
      if (dismissed || completedSteps.length === 4) {
        document.getElementById('onboardingChecklist').classList.add('hidden');
      } else {
        updateChecklistUI();
      }
    }

    function selectGoal(goal) {
      selectedGoal = goal;
      document.querySelectorAll('.goal-btn').forEach(btn => btn.classList.remove('selected'));
      event.target.closest('.goal-btn').classList.add('selected');
      
      setTimeout(() => {
        dismissWelcome();
      }, 300);
    }

    function dismissWelcome() {
      const userId = currentUser?.id || 'guest';
      localStorage.setItem(`${STORAGE_PREFIX}welcome_${userId}`, 'true');
      if (selectedGoal) {
        localStorage.setItem(`${STORAGE_PREFIX}goal_${userId}`, selectedGoal);
      }
      document.getElementById('welcomeModal').classList.add('hidden');
    }

    function completeStep(stepNum) {
      if (!completedSteps.includes(stepNum)) {
        completedSteps.push(stepNum);
        const userId = currentUser?.id || 'guest';
        localStorage.setItem(`${STORAGE_PREFIX}steps_${userId}`, JSON.stringify(completedSteps));
        updateChecklistUI();
      }
    }

    function updateChecklistUI() {
      const total = 4;
      const completed = completedSteps.length;
      const progress = (completed / total) * 100;
      
      document.getElementById('progressFill').style.width = `${progress}%`;
      document.getElementById('checklistProgress').textContent = `${completed}/${total} complete`;
      
      for (let i = 1; i <= 4; i++) {
        const step = document.getElementById(`step${i}`);
        if (completedSteps.includes(i)) {
          step.classList.add('completed');
        } else {
          step.classList.remove('completed');
        }
      }
      
      const nextBtn = document.getElementById('nextStepBtn');
      const nextStep = [1, 2, 3, 4].find(s => !completedSteps.includes(s));
      if (nextStep) {
        const labels = {
          1: 'Copy API Key ‚Üí',
          2: 'Try API Call ‚Üí',
          3: 'View Style Packs ‚Üí',
          4: 'Read Docs ‚Üí'
        };
        nextBtn.textContent = labels[nextStep];
        nextBtn.style.display = 'block';
      } else {
        document.getElementById('onboardingChecklist').innerHTML = `
          <div class="onboarding-complete">
            <h3>üéâ You're all set!</h3>
            <p>You've completed the getting started guide. Happy validating!</p>
          </div>
        `;
        setTimeout(() => {
          document.getElementById('onboardingChecklist').classList.add('hidden');
        }, 3000);
      }
    }

    function goToStep(stepNum) {
      switch (stepNum) {
        case 1:
          document.getElementById('copyKeyBtn').click();
          break;
        case 2:
          document.querySelector('.card:nth-of-type(2)').scrollIntoView({ behavior: 'smooth' });
          completeStep(2);
          break;
        case 3:
          window.open('/api/packs', '_blank');
          completeStep(3);
          break;
        case 4:
          window.location.href = '/docs.html';
          completeStep(4);
          break;
      }
    }

    function goToNextStep() {
      const nextStep = [1, 2, 3, 4].find(s => !completedSteps.includes(s));
      if (nextStep) {
        goToStep(nextStep);
      }
    }

    function dismissChecklist() {
      const userId = currentUser?.id || 'guest';
      localStorage.setItem(`${STORAGE_PREFIX}checklist_dismissed_${userId}`, 'true');
      document.getElementById('onboardingChecklist').classList.add('hidden');
    }
  </script>
</body>
</html>
